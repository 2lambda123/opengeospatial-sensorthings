[[staplus-entities]]
== STAplus Entity Type Requirements

`Party`, `License`, `Group`, `Relation` and `Project` are the entity types for STAplus. The implemented entities SHALL be listed in the response to a GET request to the root URL as described in Sensing part. 

An implementation SHALL implement all STAplus entities (with read access) as defined in the Core conformance class.

The STAplus entities are depicted in <<fig-staplus-datastream-entities>> and <<fig-staplus-multidatastream-entities>>.

[[fig-staplus-datastream-entities]]
[.text-center]
.STAplus Entities (Datastream)
image::./figures/STAplusSensingEntities.png[STAplus Entities connected to Datastream]

[[fig-staplus-multidatastream-entities]]
[.text-center]
.STAplus Entities (MultiDatastream)
image::./figures/STAplusMultiDatastreamExtensionEntities.png[STAplus Entities connected to MultiDatastream]

In this section, the properties for each entity type and the direct relation to the other entity types are explained. 

[[common-control-information]]
=== Requirements Class *Entity Control Information*

NOTE: In SensorThings control information is represented as annotations whose names start with iot followed by a dot ( . ). Annotations are name/value pairs that have a dot ( . ) as part of the name.

When annotating a name/value pair for which the value is represented as a JSON object, each annotation is placed within the object and represented as a single name/value pair. In SensorThings the name always starts with the “at” sign (@), followed by the namespace iot, followed by a dot (.), followed by the name of the term (e.g., **"@iot.id":**1).

When annotating a name/value pair for which the value is represented as a JSON array or primitive value, each annotation that applies to this name/value pair is placed next to the annotated name/value pair and represented as a single name/value pair. The name is the same as the name of the name/value pair being annotated, followed by the “at” sign (**@**), followed by the namespace iot, followed by a dot (.), followed by the name of the term.  (e.g., `+"Locations@iot.navigationLink":"http://example.org/v1.1/Things(1)/Locations"+`)

[requirements_class]
.Entity Control Information

====
[%metadata]
identifier:: /req-class/entity-control-information
obligation:: requirement
subject:: Target Type: Web Service
inherit:: <<OGC18-088>>
requirement:: /req/common-control-information
====


[requirement]
====
[%metadata]
identifier:: /req/common-control-information

Each entity SHALL have the following common control information listed in <<tab-common-control-information>>.
====

[[tab-common-control-information]]
.Common control information
[cols="20a,50a,15a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|id
|`id` is the system-generated identifier of an entity that is unique among the entities of the same entity type in a SensorThings service instance.
|Any
|One (mandatory)

|selfLink
|`selfLink` is the absolute URL of an entity that is unique among all other entities.
|URL
|One (mandatory)

|navigationLink
|`navigationLink` is the relative or absolute URL that retrieves content of related entities.
|URL
|One-to-many +
(mandatory)
|===


[[party]]
=== Requirements Class *Party*

This entity can be used to represent acting users and to model ownership. One example for ownership is that a satellite `Thing` is owned by a space agency. This ownership may entitle the space agency to be the only party that can update the thing's location. Other parties can then mount their sensor on the satellite and provide `Datastream` or `MultiDatastream` instances to upload observations. Via the association to the `Datastream` resp. `MultiDatastream` their ownership of the observations is guaranteed. By associating a license to the (multi)datastream, they could also define re-use conditions. 

[requirements_class]
.Party

====
[%metadata]
identifier:: /req-class/party
obligation:: requirement
subject:: Target Type: Web Service
inherit:: /req-class/entity-control-information
requirement:: /req/party/properties
requirement:: /req/party/relations
====


[requirement]
====
[%metadata]
identifier:: /req/party/properties

Each `Party` entity SHALL have the mandatory properties and MAY have the optional properties listed in <<tab-properties-party>>.
====

[[tab-properties-party]]
.Properties of a `Party` entity
[cols="20a,45a,20a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|role
|This is the role of the party
|CharacterString ['individual', 'institutional']
|One (mandatory)

|description
|This is a short description of the party
|CharacterString
|One (optional)

|displayName
|A property commonly used for saluting the party
|CharacterString
|One (optional)

|authId
|A system wide unique property (e.g. `REMOTE_USER` or `SUB` from authentication) to identify the party
|CharacterString
|One (optional)

|personalData
|A property to store personal data of the party
|JSON Object
|One (optional)

|===

[requirement]
====
[%metadata]
identifier:: /req/party/relations

Each `Party` entity MAY have direct relations to other entity types listed in <<tab-relations-party>>.
====

NOTE: The `personalData` property has private visibility. An implementation must ensure GDPR compliance when allowing CRUD access.

[[tab-relations-party]]
.Direct relation between a `Party` entity and other entity types
[cols="25a,20a,55a"]
|===
|Entity type |Relation |Description

|Datastream
|One optional to many optional
|A `Party` MAY have zero-to-many `Datastreams`.

|MultiDatastream
|One optional to many optional
|A `Party` MAY have zero-to-many `MultiDatastreams`.

|Thing
|One optional to many optional
|A `Party` MAY have zero-to-many `Things`.

|Group
|One optional to many optional
|A `Party` MAY have zero-to-many `Groups`.

|Project
|One optional to many optional
|A `Party` MAY have zero-to-many `Projects`.
|===


[[license]]
=== Requirements Class *License*

This entity can be used to associate a re-use condition to observations via a `Datastream` or `MultiDatastream`. It can also be used to express re-use conditions for a group (a set of observations).

[requirements_class]
.License

====
[%metadata]
identifier:: /req-class/license
obligation:: requirement
subject:: Target Type: Web Service
inherit:: /req-class/entity-control-information
requirement:: /req/license/properties
requirement:: /req/license/relations
====


[requirement]
====
[%metadata]
identifier:: /req/license/properties

Each `License` entity SHALL have the mandatory properties and MAY have the optional properties listed in <<tab-properties-license>>.
====


[[tab-properties-license]]
.Properties of a `License` entity
[cols="20a,45a,20a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|name
|A property provides a label for `License` entity, commonly a descriptive name.
|CharacterString
|One (mandatory)

|description
|This is a short description of the corresponding `License` entity.
|CharacterString
|One (mandatory)

|definition
|This is a URI referencing the `License` entity.
|URI
|One (mandatory)

|logo
|This is the data URI encoding of the logo for the `License` entity.
|CharacterString
|One (optional)

|properties
|The SensorThings API definition applies
|JSON Object
|One (optional)
|===

[requirement]
====
[%metadata]
identifier:: /req/license/relations

Each `License` entity MAY have direct relations to other entity types listed in <<tab-relations-license>>.
====

[[tab-relations-license]]
.Direct relation between a `License` entity and other entity types
[cols="25a,20a,55a"]
|===
|Entity type |Relation |Description

|Datastream
|One optional to many optional
|A `License` MAY have zero-to-many `Datastreams`.

|MultiDatastream
|One optional to many optional
|A `License` MAY have zero-to-many `MultiDatastreams`.

|Project
|One optional to many optional
|A `License` MAY have zero-to-many `Projects`.

|Group
|One optional to many optional
|A `License` MAY have zero-to-many `Groups`.
|===


[[group]]
=== Requirements Class *Group*

This entity can be used to create a bag of observations and/or relations that can be shared and re-used.

[requirements_class]
.Group

====
[%metadata]
identifier:: /req-class/group
obligation:: requirement
subject:: Target Type: Web Service
inherit:: /req-class/entity-control-information
requirement:: /req/group/properties
requirement:: /req/group/relations
====


[requirement]
====
[%metadata]
identifier:: /req/group/properties

Each `Group` entity SHALL have the mandatory properties and MAY have the optional properties listed in <<tab-properties-group>>.
====

[[tab-properties-group]]
.Properties of a `Group` entity
[cols="20a,45a,20a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|name
|A property provides a label for `Group` entity, commonly a descriptive name.
|CharacterString
|One (mandatory)

|description
|This is a short description of the corresponding `Group` entity.
|CharacterString
|One (mandatory)

|purpose
|This is a short description of the purpose for the `Group` entity.
|CharacterString
|One (optional)

|creationTime
|This is the starting time of the `Group` entity. Depending on the business logic, after this time it could be possible to add observations or relations to the Group.
|TM Instant
|One (optional)

|endTime
|This is the end time of the `Group` entity. Depending on the business logic, after this time it is no longer possible to add observations or relations to the Group. 
|TM Instant
|One (optional)

|termsOfUse
|This allows to express the term of use for the `Group` entity.
|CharacterString
|One (optional)

|privacyPolicy
|This allows to express the term of use for personal data that are contained in the `Group` entity.
|CharacterString
|One (optional)

|propeties
|The SensorThings API definition applies
|JSON Object
|One (optional)
|===

[requirement]
====
[%metadata]
identifier:: /req/group/relations

Each `Group` entity MAY have direct relations to other entity types listed in <<tab-relations-group>>.
====

[[tab-relations-group]]
.Direct relation between a `Group` entity and other entity types
[cols="25a,20a,55a"]
|===
|Entity type |Relation |Description

|License
|One optional to one optional
|A `Group` MAY have zero-to-one `License`.

|Observation
|Many optional to many optional
|A `Group` MAY have zero-to-many `Observations`.

|Relation
|Many optional to many optional
|A `Group` MAY have zero-to-many `Relations`.

|Party
|Many optional to one optional
|A `Group` MAY have zero-to-one `Party`.

|Project
|Many optional to many optional
|A `Group` MAY have zero-to-more `Project`.
|===

[[relation]]
=== Requirements Class *Relation*

This entity can be used to describe relationships between (1) two observations, or (2) one observation and a resolvable external object identified by a URI.

[requirements_class]
.Group

====
[%metadata]
identifier:: /req-class/relation
obligation:: requirement
subject:: Target Type: Web Service
inherit:: /req-class/entity-control-information
requirement:: /req/relation/properties
requirement:: /req/relation/relations
====


[requirement]
====
[%metadata]
identifier:: /req/relation/properties

Each `Relation` entity SHALL have the mandatory properties and MAY have the optional properties listed in <<tab-properties-relation>>.
====


[[tab-properties-relation]]
.Properties of a `Relation` entity
[cols="20a,45a,20a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|externalObject
|This URI references the external object for the `Relation` entity.
|CharacterString
|One (optional)

|description
|This is a short description of the corresponding `Relation` entity.
|CharacterString
|One (optional)

|role
|This URI references the definition of `Relation` entity.
|URI
|One (mandatory)

|properties
|The SensorThings API definition applies
|JSON Object
|One (optional)
|===

NOTE: The subject of a relation entity is always an observation. For expressing the object of a relation, the `object` relation XOR `externalObject` property must be used.

[requirement]
====
[%metadata]
identifier:: /req/relation/relations

Each `Relation` entity MAY have direct relations to other entity types listed in <<tab-relations-relation>>.
====

[[tab-relations-relation]]
.Direct relation between a `Relation` entity and other entity types
[cols="25a,20a,55a"]
|===
|Entity type |Relation |Description

|Observation
|One mandatory to one optional
|A `Relation` SHALL have one `Subject`.

|Observation
|One optional to one optional
|A `Relation` MAY have zero-to-one `Object` XOR `externalObject`.

|Group
|Many optional to many optional
|A `Relation` MAY have zero-to-many `Groups`.
|===

[[project]]
=== Requirements Class *Project*

This entity can be used to create a container of `Datastream` or `MultiDatastream` entities. A Project can have a particular purpose and a managing party.

[requirements_class]
.Project

====
[%metadata]
identifier:: /req-class/project
obligation:: requirement
subject:: Target Type: Web Service
inherit:: /req-class/entity-control-information
requirement:: /req/project/properties
requirement:: /req/project/relations
====


[requirement]
====
[%metadata]
identifier:: /req/project/properties

Each `Project` entity SHALL have the mandatory properties and MAY have the optional properties listed in <<tab-properties-project>>.
====

[[tab-properties-project]]
.Properties of a `Project` entity
[cols="20a,45a,20a,15a"]
|===
|Name |Definition |Data type |Multiplicity and use

|name
|A property provides a label for `Project` entity, commonly a descriptive name.
|CharacterString
|One (mandatory)

|description
|This is a short description of the corresponding `Project` entity.
|CharacterString
|One (mandatory)

|classification
|Determines if the datastream(s), multidatastream(s) or group(s) of the `Project` entity contain sensitive information
|ValueCode
|One (optional)

|description
|This is a short description of the corresponding `Project` entity.
|CharacterString
|One (mandatory)

|creationTime
|This is the starting time of the `Project` entity. Depending on the business logic, after this time it could be possible to add observations or relations to the Group.
|TM Instant
|One (optional)

|endTime
|This is the end time of the `Project` entity. Depending on the business logic, after this time it is no longer possible to add observations or relations to the Group. 
|TM Instant
|One (optional)

|termsOfUse
|This allows to express the term of use for the `Project` entity.
|CharacterString
|One (optional)

|privacyPolicy
|This allows to express the term of use for personal data that are contained in the `Project` entity.
|CharacterString
|One (optional)

|url
|This is the URL for the `Project` entity that provides additional information that cannot be captured in this entity alone.
|URL
|One (optional)

|properties
|The SensorThings API definition applies
|JSON Object
One (optional)
|===

[requirement]
====
[%metadata]
identifier:: /req/project/relations

Each `Project` entity MAY have direct relations to other entity types listed in <<tab-relations-project>>.
====

[[tab-relations-project]]
.Direct relation between a `Project` entity and other entity types
[cols="25a,20a,55a"]
|===
|Entity type |Relation |Description

|Datastream
|Many optional to many optional
|A `Project` MAY have zero-to-many `Datastreams`.

|MultiDatastream
|Many optional to many optional
|A `Project` MAY have zero-to-many `MultiDatastreams`.

|Party
|Many optional to one optional
|A `Project` MAY have zero-to-one `Party`.

|Group
|Many optional to many optional
|A `Project` MAY have zero-to-many `Group`.

|License
|Many optional to one optional
|A `Project` MAY have zero-to-one `License`.

|===
